package com.github.mouse0w0.peach.mcmod.compiler.v1_12_2;

import com.github.mouse0w0.peach.mcmod.compiler.CompileTask;
import com.github.mouse0w0.peach.mcmod.compiler.Compiler;
import com.github.mouse0w0.peach.mcmod.element.Element;
import com.github.mouse0w0.peach.mcmod.element.LocalizableElement;

import java.io.BufferedWriter;
import java.util.HashMap;
import java.util.Locale;
import java.util.Map;
import java.util.Properties;

public class LanguageTask implements CompileTask {
    @Override
    public void run(Compiler compiler) throws Exception {
        Locale language = compiler.getMetadata().getLanguage();
        String languageTag = language.getLanguage().toLowerCase() + "_" + language.getCountry().toLowerCase();
        try (BufferedWriter writer = compiler.getAssetsFiler().newWriter("lang/" + languageTag + ".lang")) {
            String namespace = compiler.getMetadata().getId();
            Properties translation = new Properties();
            Map<String, String> temp = new HashMap<>();
            for (Element element : compiler.getElements().values()) {
                if (element instanceof LocalizableElement) {
                    temp.clear();
                    ((LocalizableElement) element).getTranslation(namespace, temp);
                    translation.putAll(temp);
                }
            }
            translation.store(writer, "Generated by Peach.");
        }
    }
}
